<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>News - Cortex Club</title>
    <link rel="stylesheet" href="../style.css">
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <div class="nav-brand">
                <h1>Cortex<span class="brand-accent">Club</span></h1>
            </div>
            <ul class="nav-menu" id="navMenu">
                <li><a href="../index.html">Home</a></li>
                <li><a href="events.html">Events</a></li>
                <li><a href="news.html">News</a></li>
                <li><a href="committee.html">Committee</a></li>
                <li><a href="contact.html">Contact</a></li>
            </ul>
            <button class="nav-toggle" id="navToggle" aria-label="Toggle navigation">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </nav>

    <section class="section" style="margin-top: 70px;">
        <div class="container">
            <h2 class="section-title">News</h2>
            <div class="news-content">
                <div class="news-grid" id="newsGrid"></div>
            </div>
        </div>
    </section>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 Cortex Club, University of Oxford. All rights reserved.</p>
        </div>
    </footer>

    <script src="../utils/script.js"></script>
    <script>
        let allNews = [];

        // Format date from YYYY-MM-DD to "MON DD, YYYY"
        function formatDate(dateString) {
            const date = new Date(dateString);
            const months = ['JAN', 'FEB', 'MAR', 'APR', 'MAY', 'JUN', 'JUL', 'AUG', 'SEP', 'OCT', 'NOV', 'DEC'];
            const month = months[date.getMonth()];
            const day = date.getDate();
            const year = date.getFullYear();
            return `${month} ${day}, ${year}`;
        }

        // Load all news JSON files dynamically
        async function loadNews() {
            try {
                // First, load the index.json to get list of all news files
                const indexResponse = await fetch('../news/json/index.json');
                const indexData = await indexResponse.json();
                
                // Load all news files listed in index.json
                const promises = indexData.news.map(filename => 
                    fetch(`../news/json/${filename}`)
                        .then(response => response.json())
                        .catch(error => console.error(`Failed to load ${filename}:`, error))
                );

                const results = await Promise.all(promises);
                allNews = results.filter(news => news !== undefined);
                
                // Sort news by date (newest first)
                allNews.sort((a, b) => new Date(b.date) - new Date(a.date));
                
                console.log('Loaded news:', allNews);
                renderNews();
            } catch (error) {
                console.error('Failed to load news index:', error);
            }
        }

        function renderNews() {
            const grid = document.getElementById('newsGrid');
            if (!grid) return;

            grid.innerHTML = '';

            allNews.forEach(news => {
                const card = document.createElement('div');
                card.className = 'news-card';
                
                // Determine Read More link: 
                // 1. If readmore field exists and is not null, link to HTML file in news/html/
                // 2. Otherwise, if link exists and is not "#", use that (for external links)
                // 3. Otherwise, don't show Read More button
                let readMoreLink = null;
                if (news.readmore && news.readmore !== null) {
                    readMoreLink = `../news/html/${news.readmore}`;
                } else if (news.link && news.link !== '#' && news.link !== null) {
                    readMoreLink = news.link;
                }
                
                const readMoreButton = readMoreLink 
                    ? `<a href="${readMoreLink}" class="news-link">Read More â†’</a>`
                    : '';
                
                card.innerHTML = `
                    <div class="news-date">${formatDate(news.date)}</div>
                    <h3>${news.title}</h3>
                    <p>${news.description}</p>
                    ${readMoreButton}
                `;
                
                grid.appendChild(card);
            });
        }

        // Load news when page loads
        loadNews();
    </script>
</body>
</html>
